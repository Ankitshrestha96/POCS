<h1 id="python-decorators">Python Decorators</h1>



<h2 id="logger-and-config-in-pocs">Logger and Config in POCS</h2>

<p>We are going to look at an example of python decorators by implementing a fairly common requirement for a project: logging and configuration. The goal is to have an easy-to-use set of methods that can be applied to any module within our project and allow a developer to have access to the projects logging and configuration settings. The decorators should be fairly black-box so that the developer doesn’t need to worry about internals. Since the <code>Config</code> class is loaded as part of the <code>Logger</code> loading, so the <code>Logger</code> class can be configured from the config file, we are going to take a look at <code>Config</code> first.</p>

<p>Before we begin, however, here is what we want our developers to be able to do:</p>



<pre class="prettyprint prettyprinted"><code><span class="kwd">import</span><span class="pln"> panoptes</span><span class="pun">.</span><span class="pln">utils</span><span class="pun">.</span><span class="pln">logger </span><span class="kwd">as</span><span class="pln"> logger
</span><span class="kwd">import</span><span class="pln"> panoptes</span><span class="pun">.</span><span class="pln">utils</span><span class="pun">.</span><span class="pln">config </span><span class="kwd">as</span><span class="pln"> config

</span><span class="lit">@logger</span><span class="pun">.</span><span class="pln">has_logger
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">AbstractMount</span><span class="pun">():</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> __init__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">):</span><span class="pln">        
        </span><span class="com"># Write something to the log</span><span class="pln">
        </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">logger</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="str">'Creating AbstractMount'</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">logger</span><span class="pun">.</span><span class="pln">debug</span><span class="pun">(</span><span class="str">'Debug Level info for AbstractMount'</span><span class="pun">)</span><span class="pln">


</span><span class="lit">@logger</span><span class="pun">.</span><span class="pln">set_log_level</span><span class="pun">(</span><span class="str">'debug'</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@logger</span><span class="pun">.</span><span class="pln">has_logger
</span><span class="lit">@config</span><span class="pun">.</span><span class="pln">has_config
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Mount</span><span class="pun">(</span><span class="typ">AbstractMount</span><span class="pun">):</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> __init__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> </span><span class="pun">*</span><span class="pln">args</span><span class="pun">,</span><span class="pln"> </span><span class="pun">**</span><span class="pln">kwargs</span><span class="pun">):</span><span class="pln">
        </span><span class="com"># Get the mount type from the config</span><span class="pln">
        type </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">config</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'mount'</span><span class="pun">).</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'type'</span><span class="pun">)</span><span class="pln">

        </span><span class="com"># Write something to the log</span><span class="pln">
        </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">logger</span><span class="pun">.</span><span class="pln">info</span><span class="pun">(</span><span class="str">'Creating Mount: {}'</span><span class="pun">.</span><span class="pln">format</span><span class="pun">(</span><span class="pln">type</span><span class="pun">))</span><span class="pln">
        </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">logger</span><span class="pun">.</span><span class="pln">debug</span><span class="pun">(</span><span class="str">'Debug Level info for Mount'</span><span class="pun">)</span><span class="pln">

        </span><span class="kwd">super</span><span class="pun">().</span><span class="pln">__init__</span><span class="pun">(*</span><span class="pln">args</span><span class="pun">,</span><span class="pln"> </span><span class="pun">**</span><span class="pln">kwargs</span><span class="pun">)</span></code></pre>

<blockquote>
  <p><strong>CODE NOTE:</strong></p>
  
  <ul>
  <li>We’ve already done a check for the <code>'mount'</code> key in the config</li>
  <li><code>self.logger</code> has access to all the log levels: <code>critical</code>, <code>error</code>, <code>warning</code>, <code>info</code>, <code>debug</code></li>
  </ul>
</blockquote>



<h4 id="decorators">Decorators</h4>

<p>A brief word about python decorators. Decorators allow you to apply a function, or set of functions, to a class or method. The same thing could be done with OO programming and some cleverness. For instance, in POCS, almost everything is driven by the <code>Observatory</code> class, so we could make it our base class, read the configuration in during the <code>Observatory</code> init, and then have everything inherit from the <code>Observatory</code> class, but this is messy and begins to pollute our namespace. The advantage of a decorator is that the functionality contained within the decorator is decoupled from a specific class, giving much more flexibility. Also, the logic contained within the decorators is usually separate business logic from that contained within just a specific module, class, or method. So while our <code>Observatory</code> may need to log, it’s core logic should not contain logging methods, but rather methods like <code>start_slewing</code> and <code>check_weather</code>, which relate to the business of an observatory. The <code>Observatory</code> class is then ‘decorated’ with the other functionality. <a href="#fn:perl-roles" id="fnref:perl-roles" title="See footnote" class="footnote">1</a>

</p>

<h4 id="config-class">Config Class</h4>



<h4 id="logger-class">Logger Class</h4>

<blockquote>
  <p><a href="https://github.com/wtgee" title="@wtgee">@wtgee</a></p>
</blockquote>

<div class="footnotes"><hr><ol><li id="fn:perl-roles">In Perl, Decorators are called <a href="http://perldoc.perl.org/perlootut.html#Roles">Roles</a>, and a Role is said to be “applied” to a class or a class “consumes” a Role, which has more functional meaning to me than a Decorator “decorating” a class. <a href="#fnref:perl-roles" title="Return to article" class="reversefootnote">↩</a></li></ol></div>
